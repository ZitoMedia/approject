<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:activiti="http://activiti.org/bpmn" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" typeLanguage="http://www.w3.org/2001/XMLSchema" expressionLanguage="http://www.w3.org/1999/XPath" targetNamespace="http://activiti.org/bpmn20">
    <process id="ZitomediaMultiLevelReview" name="Zitomedia Review And Approve Activiti Process" isExecutable="true">
        <startEvent id="start" activiti:formKey="wf:submitParallelReviewTask"></startEvent>
        <sequenceFlow id="flow1" sourceRef="start" targetRef="supervisorReviewTask">
            <extensionElements>
                <activiti:executionListener event="start"
                                            class="org.alfresco.repo.workflow.activiti.listener.ScriptExecutionListener">
                    <activiti:field name="runAs"><activiti:string>admin</activiti:string></activiti:field>
                    <activiti:field name="script">
                        <activiti:string>execution.setVariable('wf_approveCount', 0);
                            execution.setVariable('wf_rejectCount', 0);
                            execution.setVariable('wf_actualPercent', 0);
                            execution.setVariable('wf_actualRejectPercent', 0);
                            execution.setVariable('wf_reviewerCount', bpm_assignees.size());
                            execution.setVariable('wf_requiredPercent', 100);
                            var UUID = new Date().getTime();
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload =  bpm_package.children[i];
                                payload.specializeType('zitomedia:invoice');
                                if (!payload.hasAspect('zitomedia:ap')) {
                                    payload.addAspect('zitomedia:ap');
                                }
                                payload.properties['zitomedia:status'] = 'Supervisor Assigned';
                                payload.save();
                                if (bpm_assignees.size() &gt; 0) {
                                    for (var j = 0, length2 = bpm_assignees.size(); j &lt; length2 ; j++) {
                                        payload.setPermission("Collaborator", bpm_assignees.get(j).properties.userName);
                                    }
                                }
                                var parent = payload.parent.parent;
                                if (parent != null) {
                                    var assignedParent = parent.childByNamePath('Assigned');
                                    if (assignedParent != null) {
                                        var assignedFolder = assignedParent.childByNamePath(UUID);
                                        if (assignedFolder == null) {
                                            assignedFolder = assignedParent.createFolder(UUID);
                                            if (bpm_assignees.size() &gt; 0) {
                                                for (var j = 0, length2 = bpm_assignees.size(); j &lt; length2 ; j++) {
                                                    assignedFolder.setPermission("Consumer", bpm_assignees.get(j).properties.userName);
                                                }
                                            }
                                        }
                                        payload.move(assignedFolder);
                                    }
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:executionListener>
            </extensionElements>
        </sequenceFlow>
        <userTask id="supervisorReviewTask" name="Supervisor Review Task" activiti:formKey="zitomediawf:zitoMediaSupervisorReviewTask">
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "Supervisor reviews invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>if(task.getVariableLocal('wf_reviewOutcome') == 'Approve') {
                            var newApprovedCount = wf_approveCount + 1;
                            var newApprovedPercentage = (newApprovedCount / wf_reviewerCount) * 100;

                            execution.setVariable('wf_approveCount', newApprovedCount);
                            execution.setVariable('wf_actualPercent', newApprovedPercentage);
                            } else {
                            var newRejectCount = wf_rejectCount + 1;
                            var newRejectPercentage = (newRejectCount / wf_reviewerCount) * 100;

                            execution.setVariable('wf_rejectCount', newRejectCount);
                            execution.setVariable('wf_actualRejectPercent', newRejectPercentage);
                            }

                            var reviewOutcome = task.getVariable('wf_reviewOutcome');
                            execution.setVariable('wf_reviewOutcome', reviewOutcome);
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                if (!bpm_package.children[i].hasAspect('zitomedia:ap')) {
                                    bpm_package.children[i].addAspect('zitomedia:ap');
                                    bpm_package.children[i].save();
                                }
                                if (reviewOutcome == 'Approve') {
                                    bpm_package.children[i].properties['zitomedia:status'] = 'Supervisor Approved';
                                } else {
                                    bpm_package.children[i].properties['zitomedia:status'] = 'Supervisor Rejected';
                                }
                                bpm_package.children[i].save();
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>

            <humanPerformer>
                <resourceAssignmentExpression>
                    <formalExpression>${reviewAssignee.properties.userName}</formalExpression>
                </resourceAssignmentExpression>
            </humanPerformer>
            <!-- For each assignee, task is created -->
            <multiInstanceLoopCharacteristics isSequential="false">
                <loopDataInputRef>bpm_assignees</loopDataInputRef>
                <inputDataItem name="reviewAssignee" />
                <completionCondition>${wf_actualPercent >= 100 || 100 > (100 - wf_actualRejectPercent)}</completionCondition>
            </multiInstanceLoopCharacteristics>
        </userTask>
        <sequenceFlow id="flow2" sourceRef="supervisorReviewTask" targetRef="supervisorReviewDecision"></sequenceFlow>
        <exclusiveGateway id="supervisorReviewDecision" name="Supervisor Review Decision"></exclusiveGateway>
        <sequenceFlow id="flow3" sourceRef="supervisorReviewDecision" targetRef="apProcessTask">
            <conditionExpression xsi:type="tFormalExpression">${wf_actualPercent >= 100}</conditionExpression>
            <!--
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Approve'}]]></conditionExpression>
            -->
        </sequenceFlow>
        <sequenceFlow id="flow4" sourceRef="supervisorReviewDecision" targetRef="supervisorRejected">
            <!--
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Reject'}]]></conditionExpression>
            -->
        </sequenceFlow>
        <userTask id="supervisorRejected" name="Supervisor Rejected" activiti:assignee="${initiator.properties.userName}" activiti:formKey="zitomediawf:zitoMediaSupervisorRejectedTask">
            <documentation>The invoice was reviewed and rejected by supervisor. Contact vendor for corrected invoice.</documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="runAs"><activiti:string>admin</activiti:string></activiti:field>
                    <activiti:field name="script">
                        <activiti:string>// Set parallel review params on task, to be kept in history
                            task.setVariableLocal('wf_reviewerCount', wf_reviewerCount);
                            task.setVariableLocal('wf_requiredPercent', 100);
                            task.setVariableLocal('wf_actualPercent', wf_actualPercent);
                            task.setVariableLocal('wf_approveCount', wf_approveCount);

                            task.description = "Contact vendor for supervisor rejected invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload = bpm_package.children[i];
                                var parent = payload.parent.parent.parent;
                                if (parent != null &amp;&amp; parent.childByNamePath('Rejected') != null) {
                                    var supervisorRejectedFolder = parent.childByNamePath('Rejected').childByNamePath('Supervisor Rejected');
                                    if (supervisorRejectedFolder != null) {
                                        payload.move(supervisorRejectedFolder);
                                    }
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow6" sourceRef="supervisorRejected" targetRef="endevent1"></sequenceFlow>
        <userTask id="apProcessTask" name="AP Process Task" activiti:candidateGroups="GROUP_AccountsPayable" activiti:formKey="zitomediawf:zitoMediaAPProcessTask">
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>// Set parallel review params on task, to be kept in history
                            task.setVariableLocal('wf_reviewerCount', wf_reviewerCount);
                            task.setVariableLocal('wf_requiredPercent', 100);
                            task.setVariableLocal('wf_actualPercent', wf_actualPercent);
                            task.setVariableLocal('wf_approveCount', wf_approveCount);

                            task.description = "AP processes supervisor approved invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                if (bpm_package.children[i].properties['zitomedia:voucherNumber'] != null) {
                                    task.setVariableLocal('zitomediawf_voucherNumber', bpm_package.children[i].properties['zitomedia:voucherNumber']);
                                }
                                if (bpm_package.children[i].properties['zitomedia:customerCategory'] != null) {
                                    task.setVariableLocal('zitomediawf_customerCategory', bpm_package.children[i].properties['zitomedia:customerCategory']);
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>var reviewOutcome = task.getVariable('wf_reviewOutcome');
                            execution.setVariable('wf_reviewOutcome', task.getVariable('wf_reviewOutcome'));
                            if (logger.isLoggingEnabled()) {
                                logger.log("zitomediawf_voucherNumber:" + task.getVariable('zitomediawf_voucherNumber'));
                                logger.log("zitomediawf_customerCategory:" + task.getVariable('zitomediawf_customerCategory')) ;
                            }
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload = bpm_package.children[i];
                                payload.properties['zitomedia:voucherNumber'] = task.getVariable('zitomediawf_voucherNumber');
                                payload.properties['zitomedia:customerCategory'] = task.getVariable('zitomediawf_customerCategory');
                                payload.properties['zitomedia:status'] = 'AP Approved';
                                payload.save();
                                if (logger.isLoggingEnabled()) {
                                    logger.log("Payload " + payload.properties['cm:name'] + " saved!");
                                }
                                var parent = payload.parent.parent.parent;
                                if (parent != null &amp;&amp; parent.childByNamePath('Processing') != null) {
                                    var processingFolder = parent.childByNamePath('Processing').childByNamePath(task.getVariable('zitomediawf_customerCategory'));
                                    if (processingFolder != null) {
                                        payload.move(processingFolder);
                                        if (logger.isLoggingEnabled()) {
                                            logger.log("Payload " + payload.properties['cm:name'] + " moved!");
                                        }
                                    }
                                }
                            }
                            execution.setVariable('bpm_assignee', person);
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <exclusiveGateway id="finalReviewDecision" name="Final Review Decision"></exclusiveGateway>
        <sequenceFlow id="flow7" sourceRef="apProcessTask" targetRef="finalReviewTask"></sequenceFlow>
        <userTask id="finalReviewTask" name="Final Review Task" activiti:assignee="james.rigas" activiti:formKey="zitomediawf:zitoMediaFinalReviewTask">
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "Performs final review of invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            //for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                            task.setVariableLocal('zitomediawf_voucherNumber', bpm_package.children[0].properties['zitomedia:voucherNumber']);
                            task.setVariableLocal('zitomediawf_customerCategory', bpm_package.children[0].properties['zitomedia:customerCategory']);
                            if (logger.isLoggingEnabled()) {
                                logger.log(task.description);
                                logger.log("finalReviewTask zitomediawf_voucherNumber:" + task.getVariable('zitomediawf_voucherNumber'));
                                logger.log("finalReviewTask zitomediawf_customerCategory:" + task.getVariable('zitomediawf_customerCategory')) ;
                            }
                            //}
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>var reviewOutcome = task.getVariable('wf_reviewOutcome');
                            execution.setVariable('wf_reviewOutcome', reviewOutcome);
                            execution.setVariable('bpm_assignee', person);
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload = bpm_package.children[i];
                                if (reviewOutcome == 'Approve') {
                                    payload.properties['zitomedia:status'] = 'Final Approved';
                                    payload.save();
                                } else {
                                    payload.properties['zitomedia:status'] = 'Final Rejected';
                                    payload.save();
                                    var parent = payload.parent.parent.parent;
                                    var customerCategory = payload.properties['zitomedia:customerCategory'];
                                    if (parent != null &amp;&amp; parent.childByNamePath('Rejected') != null) {
                                        var rejectedFolder = parent.childByNamePath('Rejected').childByNamePath(customerCategory);
                                        if (rejectedFolder != null) {
                                            payload.move(rejectedFolder);
                                        }
                                    }
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow12" sourceRef="finalReviewTask" targetRef="finalReviewDecision"></sequenceFlow>
        <sequenceFlow id="flow13" sourceRef="finalReviewDecision" targetRef="payCustomer">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Approve'}]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="flow14" sourceRef="finalReviewDecision" targetRef="apReviewTask">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Reject'}]]></conditionExpression>
        </sequenceFlow>
        <userTask id="apReviewTask" name="AP Review Task" activiti:candidateGroups="GROUP_AccountsPayable" activiti:formKey="zitomediawf:zitoMediaAPReviewTask">
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "AP reviews final rejected invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            //for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                            task.setVariableLocal('zitomediawf_voucherNumber', bpm_package.children[0].properties['zitomedia:voucherNumber']);
                            task.setVariableLocal('zitomediawf_customerCategory', bpm_package.children[0].properties['zitomedia:customerCategory']);
                            //}
                            if (logger.isLoggingEnabled()) {
                                logger.log(task.description);
                                logger.log("apReviewTask zitomediawf_voucherNumber:" + task.getVariable('zitomediawf_voucherNumber'));
                                logger.log("apReviewTask zitomediawf_customerCategory:" + task.getVariable('zitomediawf_customerCategory')) ;
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>var reviewOutcome = task.getVariable('wf_reviewOutcome');
                            execution.setVariable('wf_reviewOutcome', task.getVariable('wf_reviewOutcome'));
                            execution.setVariable('bpm_assignee', person);
                            for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload = bpm_package.children[i];
                                if (reviewOutcome == 'Approve') {
                                    payload.properties['zitomedia:status'] = 'AP Approved';
                                    payload.save();
                                    var parent = payload.parent.parent.parent;
                                    var customerCategory = payload.properties['zitomedia:customerCategory'];
                                    if (parent != null &amp;&amp; parent.childByNamePath('Incoming') != null) {
                                        payload.move(parent.childByNamePath('Incoming'));
                                    }
                                } else {
                                    payload.properties['zitomedia:status'] = 'AP Rejected';
                                    payload.save();
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <exclusiveGateway id="apReviewDecision" name="AP Review Decision"></exclusiveGateway>
        <sequenceFlow id="flow18" sourceRef="apReviewTask" targetRef="apReviewDecision"></sequenceFlow>
        <sequenceFlow id="flow8" sourceRef="apReviewDecision" targetRef="endevent1">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Approve'}]]></conditionExpression>
        </sequenceFlow>
        <userTask id="apRejected" name="AP Rejected" activiti:assignee="${initiator.properties.userName}" activiti:formKey="zitomediawf:zitoMediaAPRejectedTask">
            <documentation>The document was reviewed and rejected by AP.</documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "Contact customer for AP rejected invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;</activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow9" sourceRef="apReviewDecision" targetRef="apRejected">
            <conditionExpression xsi:type="tFormalExpression"><![CDATA[${wf_reviewOutcome == 'Reject'}]]></conditionExpression>
        </sequenceFlow>
        <sequenceFlow id="flow11" sourceRef="apRejected" targetRef="endevent1"></sequenceFlow>

        <!--
        <sequenceFlow id="flow16" sourceRef="finalRejected" targetRef="apReviewTask"></sequenceFlow>
        -->
        <userTask id="payCustomer" name="Pay Customer" activiti:candidateGroups="GROUP_AccountsPayable" activiti:formKey="zitomediawf:zitoMediaPayCustomerTask">
            <documentation>The invoice has been approved and invoice needs to send to customer.</documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "Pays customer for approved invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            //for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                task.setVariableLocal('zitomediawf_voucherNumber', bpm_package.children[0].properties['zitomedia:voucherNumber']);
                                task.setVariableLocal('zitomediawf_customerCategory', bpm_package.children[0].properties['zitomedia:customerCategory']);
                            //}
                            if (logger.isLoggingEnabled()) {
                                logger.log(task.description);
                                logger.log("payCustomer zitomediawf_voucherNumber:" + task.getVariable('zitomediawf_voucherNumber'));
                                logger.log("payCustomer zitomediawf_customerCategory:" + task.getVariable('zitomediawf_customerCategory')) ;
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
                <activiti:taskListener event="complete" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                var payload = bpm_package.children[i];
                                payload.properties['zitomedia:status'] = 'Customer Paid';
                                payload.save();
                                var parent = payload.parent.parent.parent;
                                var customerCategory = payload.properties['zitomedia:customerCategory'];
                                if (parent != null &amp;&amp; parent.childByNamePath('Processed') != null) {
                                    var processedFolder = parent.childByNamePath('Processed').childByNamePath(customerCategory);
                                    if (processedFolder != null) {
                                        payload.move(processedFolder);
                                    }
                                }
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <userTask id="processCompleted" name="Process Completed" activiti:assignee="${initiator.properties.userName}" activiti:formKey="zitomediawf:zitoMediaCompletedTask">
            <documentation>Process completed.</documentation>
            <extensionElements>
                <activiti:taskListener event="create" class="org.alfresco.repo.workflow.activiti.tasklistener.ScriptTaskListener">
                    <activiti:field name="script">
                        <activiti:string>task.description = "Completes review process for invoice ";
                            if ( bpm_package.children.length &gt; 0 ) {
                                task.description += bpm_package.children[0].properties['cm:name'];
                            }
                            if (typeof bpm_workflowDueDate != 'undefined') task.dueDate = bpm_workflowDueDate
                            if (typeof bpm_workflowPriority != 'undefined') task.priority = bpm_workflowPriority;
                            //for (var i = 0, length = bpm_package.children.length ; i &lt; length ; i++) {
                                task.setVariableLocal('zitomediawf_voucherNumber', bpm_package.children[0].properties['zitomedia:voucherNumber']);
                                task.setVariableLocal('zitomediawf_customerCategory', bpm_package.children[0].properties['zitomedia:customerCategory']);
                            //}
                            if (logger.isLoggingEnabled()) {
                                logger.log(task.description);
                                logger.log("processCompleted zitomediawf_voucherNumber:" + task.getVariable('zitomediawf_voucherNumber'));
                                logger.log("processComplated zitomediawf_customerCategory:" + task.getVariable('zitomediawf_customerCategory')) ;
                            }
                        </activiti:string>
                    </activiti:field>
                </activiti:taskListener>
            </extensionElements>
        </userTask>
        <sequenceFlow id="flow15" sourceRef="payCustomer" targetRef="processCompleted"></sequenceFlow>
        <endEvent id="endevent1" name="End"></endEvent>
        <sequenceFlow id="flow17" sourceRef="processCompleted" targetRef="endevent1"></sequenceFlow>
    </process>
    <bpmndi:BPMNDiagram id="BPMNDiagram_activitiReview">
        <bpmndi:BPMNPlane bpmnElement="activitiReview" id="BPMNPlane_activitiReview">
            <bpmndi:BPMNShape bpmnElement="start" id="BPMNShape_start">
                <omgdc:Bounds height="35.0" width="35.0" x="30.0" y="200.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="supervisorReviewTask" id="BPMNShape_reviewTask">
                <omgdc:Bounds height="55.0" width="105.0" x="105.0" y="190.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="supervisorReviewDecision" id="BPMNShape_reviewDecision">
                <omgdc:Bounds height="40.0" width="40.0" x="240.0" y="197.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="supervisorApproved" id="BPMNShape_approved">
                <omgdc:Bounds height="55.0" width="105.0" x="330.0" y="137.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="supervisorRejected" id="BPMNShape_rejected">
                <omgdc:Bounds height="55.0" width="105.0" x="330.0" y="257.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="endevent1" id="BPMNShape_endevent1">
                <omgdc:Bounds height="35.0" width="35.0" x="1250.0" y="267.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="apReviewDecision" id="BPMNShape_reviewDecision1">
                <omgdc:Bounds height="40.0" width="40.0" x="590.0" y="27.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="finalReviewDecision" id="BPMNShape_reviewDecision2">
                <omgdc:Bounds height="40.0" width="40.0" x="990.0" y="-133.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="apProcessTask" id="BPMNShape_reviewTask1">
                <omgdc:Bounds height="55.0" width="105.0" x="434.0" y="20.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="apApproved" id="BPMNShape_approved1">
                <omgdc:Bounds height="55.0" width="105.0" x="680.0" y="-40.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="apRejected" id="BPMNShape_rejected1">
                <omgdc:Bounds height="55.0" width="105.0" x="680.0" y="67.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="finalReviewTask" id="BPMNShape_reviewTask2">
                <omgdc:Bounds height="55.0" width="105.0" x="830.0" y="-140.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="finalApproved" id="BPMNShape_approved2">
                <omgdc:Bounds height="55.0" width="105.0" x="1075.0" y="-194.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="finalRejected" id="BPMNShape_rejected2">
                <omgdc:Bounds height="55.0" width="105.0" x="1075.0" y="-86.0"></omgdc:Bounds>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
                <omgdi:waypoint x="65.0" y="217.0"></omgdi:waypoint>
                <omgdi:waypoint x="105.0" y="217.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
                <omgdi:waypoint x="210.0" y="217.0"></omgdi:waypoint>
                <omgdi:waypoint x="240.0" y="217.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow3" id="BPMNEdge_flow3">
                <omgdi:waypoint x="260.0" y="197.0"></omgdi:waypoint>
                <omgdi:waypoint x="270.0" y="164.0"></omgdi:waypoint>
                <omgdi:waypoint x="330.0" y="164.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow4" id="BPMNEdge_flow4">
                <omgdi:waypoint x="260.0" y="237.0"></omgdi:waypoint>
                <omgdi:waypoint x="270.0" y="284.0"></omgdi:waypoint>
                <omgdi:waypoint x="330.0" y="284.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow8" id="BPMNEdge_flow8">
                <omgdi:waypoint x="610.0" y="27.0"></omgdi:waypoint>
                <omgdi:waypoint x="614.0" y="-11.0"></omgdi:waypoint>
                <omgdi:waypoint x="680.0" y="-13.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow9" id="BPMNEdge_flow9">
                <omgdi:waypoint x="610.0" y="67.0"></omgdi:waypoint>
                <omgdi:waypoint x="614.0" y="94.0"></omgdi:waypoint>
                <omgdi:waypoint x="680.0" y="94.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow10" id="BPMNEdge_flow10">
                <omgdi:waypoint x="785.0" y="-13.0"></omgdi:waypoint>
                <omgdi:waypoint x="882.0" y="-13.0"></omgdi:waypoint>
                <omgdi:waypoint x="882.0" y="-85.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow11" id="BPMNEdge_flow11">
                <omgdi:waypoint x="732.0" y="122.0"></omgdi:waypoint>
                <omgdi:waypoint x="732.0" y="331.0"></omgdi:waypoint>
                <omgdi:waypoint x="157.0" y="331.0"></omgdi:waypoint>
                <omgdi:waypoint x="157.0" y="245.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow12" id="BPMNEdge_flow12">
                <omgdi:waypoint x="935.0" y="-113.0"></omgdi:waypoint>
                <omgdi:waypoint x="990.0" y="-113.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow13" id="BPMNEdge_flow13">
                <omgdi:waypoint x="1010.0" y="-133.0"></omgdi:waypoint>
                <omgdi:waypoint x="1009.0" y="-165.0"></omgdi:waypoint>
                <omgdi:waypoint x="1075.0" y="-167.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow14" id="BPMNEdge_flow14">
                <omgdi:waypoint x="1010.0" y="-93.0"></omgdi:waypoint>
                <omgdi:waypoint x="1011.0" y="-58.0"></omgdi:waypoint>
                <omgdi:waypoint x="1075.0" y="-59.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow15" id="BPMNEdge_flow15">
                <omgdi:waypoint x="1180.0" y="-167.0"></omgdi:waypoint>
                <omgdi:waypoint x="1267.0" y="-167.0"></omgdi:waypoint>
                <omgdi:waypoint x="1267.0" y="267.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow16" id="BPMNEdge_flow16">
                <omgdi:waypoint x="1127.0" y="-31.0"></omgdi:waypoint>
                <omgdi:waypoint x="1128.0" y="136.0"></omgdi:waypoint>
                <omgdi:waypoint x="617.0" y="136.0"></omgdi:waypoint>
                <omgdi:waypoint x="486.0" y="75.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow7" id="BPMNEdge_flow7">
                <omgdi:waypoint x="539.0" y="47.0"></omgdi:waypoint>
                <omgdi:waypoint x="590.0" y="47.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow6" id="BPMNEdge_flow6">
                <omgdi:waypoint x="435.0" y="284.0"></omgdi:waypoint>
                <omgdi:waypoint x="1250.0" y="284.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow5" id="BPMNEdge_flow5">
                <omgdi:waypoint x="435.0" y="164.0"></omgdi:waypoint>
                <omgdi:waypoint x="486.0" y="163.0"></omgdi:waypoint>
                <omgdi:waypoint x="486.0" y="75.0"></omgdi:waypoint>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>
